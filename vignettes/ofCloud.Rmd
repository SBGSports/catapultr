---
title: "OpenField Cloud API"
author: "Sergey Sandler"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{OpenField Cloud API}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

<http://catapultr.catapultsports.com> - the catapultR package home.

```{r setup}
library(catapultR)
```

## Types of data accessible with *catapultR* from the cloud by consuming OpenField APIs,
- 10 Hz sensor data - *ofCloudGetActivitySensorData()*, *ofCloudGetPeriodSensorData()*,\n
- Inertial Measurment Analysis (IMA) events - *ofCloudGetActivityEvents()*, *ofCloudGetPeriodEvents()*,\n
- Velocity and acceleration efforts (generation 2) - *ofCloudGetActivityEfforts()*, *ofCloudGetPeriodEfforts()*.\n

### An access token, an athlete ID and an activity or period ID are the required parameters to the above APIs,
- *ofCloudGetToken()* returns an access token as a result of OpenField Cloud login,\n
- *ofCloudGetAthletes()*, *ofCloudGetAthletesInActivity()* or *ofCloudGetAthletesInPeriod()* return athlete IDs,\n
- *ofCloudGetActivities()* and *ofCloudGetPeriods()* return activity and period IDs respectively.\n

## 10 Hz sensor data example
```{r, include = TRUE,  comment = "", echo=TRUE}
if (suppressMessages(require("DT")))
{
	x <- suppressMessages(readr::read_csv(of10HzDataFileCSV()))
	DT::datatable(x) %>% DT::formatRound('x', 3) %>% DT::formatRound('y', 3)
}
```

## IMA events
### Available IMA events:
```{r, include = TRUE,  comment = "", echo=TRUE, results='asis'}
cat(paste('- ', ima_events()), sep='\n')
```

The set of available events is controlled by available sport plugins. The modules allocated to a user
account control the plugins that are available. Modules are allocated by Catapult support staff.  
  
### The IMA events are generated by:
- *ima_acceleration*, either built-in IMA v.2 event, or 'Footstrikes' sport plugin generated IMA v2.3 event,\n
- *ima_jump*, a built-in IMA v.2 event,\n
- *ima_impact*, a built-in IMA v.2 event, or 'Impacts' sport plugin generated IMA v2.3 event,\n
- *goalkeeping_v1*, 'GK.v1' sport plugin generated event,\n
- *goalkeeping_v2*, 'GK.v2' sport plugin generated event,\n
- *cricket_delivery_au*, *cricket_delivery*, 'Cricket' sport plugin generated event, the event type is controlled by the sport plugin custom parameters,\n
- *running_symmetry*, 'runningsymmetry64' sport plugin generated event,\n
- *ice_hockey_stride*, *ice_hockey_bout*, 'Hockey' sport plugin generated events,\n
- *ice_hockey_goaltender_movement*, 'IceHockeyGoaltender' sport plugin generated events,\n
- *baseball_pitch_v1*, *baseball_swing_v1*, 'Baseball' generation 1 sport plugin generated events,\n
- *baseball_pitch*, *baseball_swing*, *baseball_throw*, 'Baseball' generation 2 sport plugin generated events,\n
- *free_running*, *football_movement_analysis*, 'MovementMetrics' sport plugin generated events,\n
- *rugby_union_scrum*, *rugby_union_contact_involvement*, *rugby_union_kick*, *rugby_union_lineout*, 'Rugby' sport plugin generated events,\n
- *rugby_league_tackle*, 'RugbyTackles' sport plugin generated event,\n
- *us_football_lineman_contact*, 'Lineman' sport plugin generated event,\n
- *us_football_throw*, 'FootballThrow' sport plugin generated event,\n
- *us_football_impact*, 'FootballImpact' sport plugin generated event,\n
- *basketball*, 'Basketball' sport plugin generated event.\n

### Accessing IMA events stored in the cloud
```{r, include = TRUE,  comment = "", echo=TRUE, eval=FALSE}
token <- ofCloudGetToken("APAC", "sergey", "password", "clientID", "clientSecret")
to <- as.integer(Sys.time()); from <- to - 7*24*60*60
activities <- ofCloudGetActivities(token, to = to, from = from)
athletes <- ofCloudGetAthletesInActivity(token, activities$id[1])
events <- ofCloudGetActivityEvents(token, athletes$id[1], activities$id[1], c("ima_acceleration", "ima_impact"))
eventsAcceleration <- events[["ima_acceleration"]]
eventsImpact <- events[["ima_impact"]]
```

### IMA events example: *rugby_union_scrum* event
```{r, include = TRUE,  comment = "", echo=TRUE}
if (suppressMessages(require("DT")))
{
	x <- suppressMessages(readr::read_csv(ofIMAFileCSV()))
	DT::datatable(x)
}
```

## Velocity efforts example
```{r, include = TRUE,  comment = "", echo=TRUE}
if (suppressMessages(require("DT")))
{
	x <- suppressMessages(readr::read_csv(ofVelEffortsFileCSV()))
	DT::datatable(x)
}
```
